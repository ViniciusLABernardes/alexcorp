<?php
use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\Exception;
require 'phpmailer/src/Exception.php';
require 'phpmailer/src/PHPMailer.php';
require 'phpmailer/src/SMTP.php'; if ($_SERVER["REQUEST_METHOD"]==="POST"){ if (isset($_POST["email"])){ $email=$_POST["email"]; $server="localhost"; $user='root'; $password="Vinileandro0807200323!"; $name='animesite'; $port=3308; $connect=mysqli_connect($server, $user, $password, $name, $port); if (!$connect){ die("Connection failed: " . mysqli_connect_error());} $checkQuery="SELECT * FROM cadastro WHERE Email='$email'"; $result=mysqli_query($connect, $checkQuery); if (mysqli_num_rows($result) >0){ $row=mysqli_fetch_assoc($result); $userId=$row['Id']; $token=bin2hex(random_bytes(32)); $expiresAt=date('Y-m-d H:i:s', strtotime('+1 hour')); $insertQuery="INSERT INTO password_reset_tokens (User_id, Token, Expires_at) VALUES ($userId, '$token', '$expiresAt')"; if (mysqli_query($connect, $insertQuery)){ $mensagem="Olá! Você solicitou a recuperação de senha. Clique no link a seguir para redefinir sua senha:\n<br>"; $mensagem .="http://localhost/alexcorp/utils/mudarSenha.html?token=" . $token; $mail=new PHPMailer(true); $mail->isSMTP(); $mail->Host='smtp.gmail.com'; $mail->SMTPAuth=true; $mail->Username='alexcorp883@gmail.com'; $mail->Password='upqgmrcghrouqgto'; $mail->SMTPSecure='ssl'; $mail->Port=465; $mail->setFrom('alexcorp883@gmail.com'); $mail->addAddress($email); $mail->isHTML(true); $mail->CharSet='UTF-8'; $mail->Subject='Recuperação de Senha'; $mail->Body=$mensagem; if ($mail->send()){ echo "Email de recuperação enviado com sucesso!";} else{ echo "Erro ao enviar o e-mail de recuperação: " . $mail->ErrorInfo;}} else{ echo "Erro ao inserir o token no banco de dados";}} else{ echo "Email não encontrado";}} else{ echo "O campo de email é obrigatório";}}
?>